<!-- src/app/components/chat/chat.html -->
<div class="chat-container">
  <!-- Header -->
  <div class="chat-header">
    @if (group && channel) {
    <h2>Group: {{ group.name }}, Channel: {{ channel.name }}</h2>
    } @else {
    <h2>Loading chat...</h2>
    }
    <button (click)="goBackToDashboard()" class="back-btn">Back to Dashboard</button>
  </div>

  <!-- Messages Area -->
  <div class="messages-area">
    @if (messages.length === 0) {
    <p class="no-messages">No messages yet. Start the conversation!</p>
    } @else { @for (message of messages; track message.id) {
    <div
      class="message"
      [class.own-message]="message.username === currentUser?.username"
      [class.system-message]="message.type === 'system'"
    >
      @if (message.type !== 'system') {
      <!-- Avatar -->
      <div class="message-avatar">
        @if (getUserAvatar(message.username)) {
        <img
          [src]="'http://localhost:3000' + getUserAvatar(message.username)"
          class="avatar-img"
          alt="Avatar"
        />
        } @else {
        <div class="avatar-placeholder">
          {{ message.username.charAt(0).toUpperCase() }}
        </div>
        }
      </div>
      }

      <div class="message-content-wrapper">
        <!-- Username header -->
        @if (message.type !== 'system') {
        <div class="message-header">
          <strong>{{ message.username }}</strong>
        </div>
        }

        <!-- Text message -->
        @if (message.type !== 'image' && message.type !== 'system') {
        <div class="message-content">{{ message.content }}</div>
        }

        <!-- Image message -->
        @if (message.type === 'image') {
        <div class="image-message">
          <img
            [src]="'http://localhost:3000' + message.imageUrl"
            alt="Shared image"
            class="chat-image"
          />
          <div class="image-caption">{{ message.content }}</div>
        </div>
        }

        <!-- System message -->
        @if (message.type === 'system') {
        <div class="message-content">{{ message.content }}</div>
        }

        <div class="message-footer">
          <span class="timestamp">{{ message.timestamp | date : 'short' }}</span>
        </div>
      </div>
    </div>
    } }
  </div>

  <!-- Message Input -->
  <div class="message-input-area">
    <div class="input-group">
      <input
        type="text"
        [(ngModel)]="newMessageContent"
        (keyup.enter)="sendMessage()"
        placeholder="Type your message..."
        class="message-input"
      />

      <input
        type="file"
        id="imageInput"
        (change)="onImageSelected($event)"
        accept="image/*"
        style="display: none"
      />
      <button (click)="sendMessage()" [disabled]="!newMessageContent.trim()" class="send-btn">
        Send
      </button>
    </div>
    <div class="image-section">
      @if (selectedImage) {
      <span>Selected: {{ selectedImage.name }}</span>
      <button (click)="sendImageMessage()" class="send-image-btn">Send Image</button>
      <button (click)="cancelImageSelection()" class="cancel-btn">Cancel</button>
      } @else {
      <button type="button" (click)="triggerFileInput()" class="image-btn" title="Send Image">
        Send Image
      </button>
      }
    </div>
  </div>
</div>
