<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="user-info">
      <span>Welcome, {{ currentUser?.username }} ({{ getCurrentUserRole() }})</span>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </div>
  </header>

  <!-- Super Admin Section -->
  @if (isSuperAdmin()) {
    <div class="admin-section">
      <h2>Super Admin Controls</h2>
      
      <!-- User Management -->
      <div class="management-panel">
        <h3>User Management</h3>
        
        <!-- Add User Form -->
        <div class="form-section">
          <h4>Create New User</h4>
          <form (ngSubmit)="createUser()" class="user-form">
            <div class="form-row">
              <input 
                [(ngModel)]="newUser.username" 
                name="username"
                placeholder="Username" 
                required
                class="form-input">
              <input 
                [(ngModel)]="newUser.email" 
                name="email"
                type="email"
                placeholder="Email" 
                required
                class="form-input">
              <input 
                [(ngModel)]="newUser.password" 
                name="password"
                type="password"
                placeholder="Password" 
                class="form-input">
              <button type="submit" class="btn btn-primary">Create User</button>
            </div>
          </form>
        </div>

        <!-- Users List -->
        <div class="list-section">
          <h4>All Users</h4>
          <div class="users-grid">
            @for (user of users; track user.id) {
              <div class="user-card">
                <div class="user-info">
                  <strong>{{ user.username }}</strong>
                  <p>{{ user.email }}</p>
                  <span class="user-roles">{{ user.roles?.join(', ') }}</span>
                </div>
                @if (user.username !== 'super') {
                  <button 
                    (click)="deleteUser(user)" 
                    class="btn btn-danger btn-sm">
                    Delete
                  </button>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Group Admin Section -->
  @if (isGroupAdmin() || isSuperAdmin()) {
    <div class="admin-section">
      <h2>Group Management</h2>
      
      <!-- Create Group Form -->
      <div class="form-section">
        <h4>Create New Group</h4>
        <form (ngSubmit)="createGroup()" class="group-form">
          <div class="form-row">
            <input 
              [(ngModel)]="newGroup.name" 
              name="groupName"
              placeholder="Group Name" 
              required
              class="form-input">
            <button type="submit" class="btn btn-primary">Create Group</button>
          </div>
        </form>
      </div>

      <!-- Groups List -->
      <div class="list-section">
        <h4>All Groups</h4>
        <div class="groups-list">
          @for (group of groups; track group.id) {
            <div class="group-card">
              <div class="group-header">
                <h5>{{ group.name }}</h5>
                <div class="group-actions">
                  <button (click)="deleteGroup(group)" class="btn btn-danger btn-sm">Delete Group</button>
                </div>
              </div>
              
              <div class="group-details">
                <div class="group-section">
                  <h6>Members ({{ group.members.length || 0 }})</h6>
                  <div class="members-list">
                    @for (member of group.members; track member) {
                      <span class="member-tag">
                        {{ member }}
                        <button (click)="removeUserFromGroup(group, member)" class="remove-btn">x</button>
                      </span>
                    }
                  </div>
                  
                  <!-- Add User to Group -->
                  <div class="add-member-form">
                    <select [(ngModel)]="selectedUserForGroup[group.id]" class="form-select">
                      <option value="">Select user to add...</option>
                      @for (user of getAvailableUsersForGroup(group); track user.id) {
                        <option [value]="user.username">
                          {{ user.username }}
                        </option>
                      }
                    </select>
                    <button 
                      (click)="addUserToGroup(group, selectedUserForGroup[group.id])"
                      [disabled]="!selectedUserForGroup[group.id]"
                      class="btn btn-secondary btn-sm">
                      Add User
                    </button>
                  </div>
                </div>

                <div class="group-section">
                  <h6>Channels ({{ group.channels.length || 0 }})</h6>
                  
                  <!-- Add Channel Form -->
                  <div class="add-channel-form">
                    <input 
                      [(ngModel)]="newChannelName[group.id]" 
                      placeholder="Channel name"
                      class="form-input form-input-sm">
                    <button 
                      (click)="addChannelToGroup(group, newChannelName[group.id])"
                      [disabled]="!newChannelName[group.id]"
                      class="btn btn-secondary btn-sm">
                      Add Channel
                    </button>
                  </div>
                  
                  <!-- Channels List -->
                  <div class="channels-list">
                    @for (channel of group.channels; track channel.id) {
                      <div class="channel-item">
                        <div class="channel-header">
                          <strong># {{ channel.name }}</strong>
                          <button (click)="removeChannelFromGroup(group, channel)" class="btn btn-danger btn-xs">Delete</button>
                        </div>
                        
                        <div class="channel-members">
                          @for (member of channel.members; track member) {
                            <span class="member-tag">
                              {{ member }}
                              <button (click)="removeUserFromChannel(group, channel, member)" class="remove-btn">Ã—</button>
                            </span>
                          }
                        </div>
                        
                        <!-- Add User to Channel -->
                        <div class="add-to-channel">
                          <select [(ngModel)]="selectedUserForChannel[group.id + '_' + channel.id]" class="form-select form-select-sm">
                            <option value="">Add member to channel...</option>
                            @for (member of getAvailableUsersForChannel(group, channel); track member) {
                              <option [value]="member">
                                {{ member }}
                              </option>
                            }
                          </select>
                          <button 
                            (click)="addUserToChannel(group, channel, selectedUserForChannel[group.id + '_' + channel.id])"
                            [disabled]="!selectedUserForChannel[group.id + '_' + channel.id]"
                            class="btn btn-secondary btn-xs">
                            Add
                          </button>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  }

  <!-- Regular User Section -->
  @if (!isSuperAdmin() && !isGroupAdmin()) {
    <div class="user-section">
      <h2>Welcome to the Dashboard</h2>
      <p>You are logged in as a regular user.</p>
      
      <div class="user-groups">
        <h3>Your Groups</h3>
        @for (group of getUserGroups(); track group.id) {
          <div class="user-group-card">
            <h4>{{ group.name }}</h4>
            <p>Channels you can access:</p>
            <ul>
              @for (channel of getUserChannelsInGroup(group); track channel.id) {
                <li># {{ channel.name }}</li>
              }
            </ul>
          </div>
        }
      </div>
    </div>
  }

  <!-- Error/Success Messages -->
  @if (message) {
    <div class="message" [ngClass]="messageType">
      {{ message }}
    </div>
  }
</div>
